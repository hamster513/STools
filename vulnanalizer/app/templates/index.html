{% extends "base.html" %}

{% block title %}VulnAnalizer - –ê–Ω–∞–ª–∏–∑ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="/static/css/pages/vulnanalizer.css?v=4.4">
{% endblock %}

{% block ui_manager_js %}
    <script src="/static/js/ui-manager.js?v=6.1"></script>
{% endblock %}

<!-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏–∑ base.html -->

{% block sidebar_tabs %}
<a href="#" class="sidebar-tab active" data-page="analysis">
    <div class="sidebar-tab-icon">
        <i class="fas fa-search-plus"></i>
    </div>
    <span class="sidebar-tab-title">–ü–æ–∏—Å–∫</span>
</a>
<a href="#" class="sidebar-tab" data-page="hosts">
    <div class="sidebar-tab-icon">
        <i class="fas fa-database"></i>
    </div>
    <span class="sidebar-tab-title">–ò–º–ø–æ—Ä—Ç</span>
</a>
<a href="#" class="sidebar-tab" data-page="settings">
    <div class="sidebar-tab-icon">
        <i class="fas fa-sliders-h"></i>
    </div>
    <span class="sidebar-tab-title">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
</a>
{% endblock %}

{% block content %}
<!-- –û—Å–Ω–æ–≤–Ω–æ–π –∫–æ–Ω—Ç–µ–Ω—Ç -->
<main class="main-content">
    <div class="page-container">
        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∞–Ω–∞–ª–∏–∑–∞ -->
        <div id="analysis-page" class="page-content active">
            <div class="analysis-container content-block">
                <div class="hosts-search-form">
                    <h3>–ö—Ä–∏—Ç–µ—Ä–∏–∏ –ø–æ–∏—Å–∫–∞</h3>
                    <form id="hosts-search-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="hostname-search">–ò–º—è —Ö–æ—Å—Ç–∞:</label>
                                <input type="text" id="hostname-search" name="hostname" placeholder="server.example.com">
                            </div>
                            <div class="form-group">
                                <label for="ip-search">IP –∞–¥—Ä–µ—Å:</label>
                                <input type="text" id="ip-search" name="ip_address" placeholder="192.168.1.1">
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="cve-host-search">CVE:</label>
                                <input type="text" id="cve-host-search" name="cve" placeholder="CVE-2021-44228">
                            </div>
                            <div class="form-group">
                                <label for="criticality-search">–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å:</label>
                                <select id="criticality-search" name="criticality">
                                    <option value="">–í—Å–µ</option>
                                    <option value="Critical">Critical</option>
                                    <option value="High">High</option>
                                    <option value="Medium">Medium</option>
                                    <option value="Low">Low</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="exploits-only" name="exploits_only">
                                <label for="exploits-only">–¢–æ–ª—å–∫–æ —Å —ç–∫—Å–ø–ª–æ–π—Ç–∞–º–∏</label>
                            </div>
                            <div class="form-group checkbox-group">
                                <input type="checkbox" id="epss-only" name="epss_only">
                                <label for="epss-only">–¢–æ–ª—å–∫–æ —Å EPSS</label>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="results-per-page">–ó–∞–ø–∏—Å–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ:</label>
                                <select id="results-per-page" name="limit">
                                    <option value="20">20</option>
                                    <option value="50">50</option>
                                    <option value="100" selected>100</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="sort-by">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞:</label>
                                <select id="sort-by" name="sort_by">
                                    <option value="">–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é</option>
                                    <option value="risk_score_desc">–ü–æ —Ä–∏—Å–∫—É (—É–±—ã–≤–∞–Ω–∏–µ)</option>
                                    <option value="risk_score_asc">–ü–æ —Ä–∏—Å–∫—É (–≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ)</option>
                                    <option value="cvss_desc">–ü–æ CVSS (—É–±—ã–≤–∞–Ω–∏–µ)</option>
                                    <option value="cvss_asc">–ü–æ CVSS (–≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ)</option>
                                    <option value="epss_score_desc">–ü–æ EPSS (—É–±—ã–≤–∞–Ω–∏–µ)</option>
                                    <option value="epss_score_asc">–ü–æ EPSS (–≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ)</option>
                                    <option value="exploits_count_desc">–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —ç–∫—Å–ø–ª–æ–π—Ç–æ–≤ (—É–±—ã–≤–∞–Ω–∏–µ)</option>
                                    <option value="exploits_count_asc">–ü–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É —ç–∫—Å–ø–ª–æ–π—Ç–æ–≤ (–≤–æ–∑—Ä–∞—Å—Ç–∞–Ω–∏–µ)</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-sm">
                                <i class="fas fa-search"></i> –ù–∞–π—Ç–∏
                            </button>
                            <button type="button" id="clear-hosts-results" class="btn btn-secondary btn-sm">
                                <i class="fas fa-times"></i> –û—á–∏—Å—Ç–∏—Ç—å
                            </button>
                            <button type="button" id="export-hosts" class="btn btn-success btn-sm">
                                <i class="fas fa-file-excel"></i> –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- –û—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ–∏—Å–∫–∞ -->
            <div class="hosts-search-results-container content-block content-block-no-margin">
                <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Ç–∞–±–ª–∏—Ü—ã —Å –ø–æ–¥–ø–∏—Å—è–º–∏ –∫–æ–ª–æ–Ω–æ–∫ -->
                <div class="hosts-table-header">
                    <div class="host-item single-line">
                        <div class="host-name">Host</div>
                        <div class="host-ip">IP</div>
                        <div class="host-criticality">Severity</div>
                        <div class="host-cve">CVE</div>
                        <div class="host-cvss">CVSS</div>
                        <div class="host-status">EPSS</div>
                        <div class="host-exploits">PoC</div>
                        <div class="host-risk">Risk</div>
                    </div>
                </div>
                <div id="hosts-search-results" class="hosts-results">
                    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ —Ö–æ—Å—Ç–æ–≤ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                </div>
                <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
                <div id="hosts-pagination" class="pagination-container" style="display: none;">
                    <div class="pagination-info">
                        <span id="pagination-info">–ü–æ–∫–∞–∑–∞–Ω–æ 0 –∏–∑ 0 –∑–∞–ø–∏—Å–µ–π</span>
                    </div>
                    <div class="pagination-controls">
                        <button id="prev-page" class="btn btn-secondary btn-sm" disabled>
                            <i class="fas fa-chevron-left"></i> –ü—Ä–µ–¥—ã–¥—É—â–∞—è
                        </button>
                        <span id="page-numbers" class="page-numbers"></span>
                        <button id="next-page" class="btn btn-secondary btn-sm" disabled>
                            –°–ª–µ–¥—É—é—â–∞—è <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∏–º–ø–æ—Ä—Ç–∞ —Ö–æ—Å—Ç–æ–≤ -->
        <div id="hosts-page" class="page-content">
            <div class="content-header">
                <h2>–ò–º–ø–æ—Ä—Ç —Ö–æ—Å—Ç–æ–≤</h2>
                <p>–ó–∞–≥—Ä—É–∑–∫–∞ –∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –æ —Ö–æ—Å—Ç–∞—Ö</p>
            </div>
            
            <div class="hosts-container content-block">
                <h3><i class="fas fa-server"></i> –ò–º–ø–æ—Ä—Ç —Ö–æ—Å—Ç–æ–≤ –∏–∑ MP VM</h3>
                <form id="hosts-upload-form" enctype="multipart/form-data">
                    <div class="form-group">
                        <label for="hosts-file">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Ö–æ—Å—Ç–æ–≤:</label>
                        <input type="file" id="hosts-file" name="file" accept=".csv,.zip,.gz,.gzip" required>
                        <small>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: CSV, ZIP, GZIP</small>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="btn btn-primary btn-sm" id="hosts-upload-btn">
                            <i class="fas fa-upload"></i> <span class="btn-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å CSV</span>
                            <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                        </button>

                        <button type="button" id="update-hosts-parallel-btn" class="btn btn-primary btn-sm">
                            <i class="fas fa-sync-alt"></i> <span class="btn-text">–ü–æ–ª–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
                            <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                        </button>
                        <button type="button" id="cancel-update-btn" class="btn btn-danger btn-sm" style="display:none;">
                            <i class="fas fa-stop"></i> <span class="btn-text">–û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ</span>
                        </button>
                    </div>
                </form>
                <div id="hosts-status" style="margin-top:2rem;"></div>
                
                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä –∏–º–ø–æ—Ä—Ç–∞ -->
                <div id="import-progress-container" style="display:none; margin-top:2rem;">
                    <h4>–ü—Ä–æ–≥—Ä–µ—Å—Å –∏–º–ø–æ—Ä—Ç–∞</h4>
                    <div class="operation-status">
                        <div class="operation-step">
                            <span id="current-step-text">–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞...</span>
                        </div>
                        <div class="operation-progress-bar">
                            <div id="progress-bar-fill" class="operation-progress-fill" style="width: 0%"></div>
                            <div class="operation-progress-text" id="overall-progress-text">0%</div>
                        </div>
                        <div class="operation-details">
                            <div class="operation-item">
                                <span class="operation-label">–í—Å–µ–≥–æ –∑–∞–ø–∏—Å–µ–π:</span>
                                <span id="total-records-text">0</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- –ü—Ä–æ–≥—Ä–µ—Å—Å —Ñ–æ–Ω–æ–≤–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è -->
                <div id="background-update-progress-container" style="display:none; margin-top:2rem;">
                    <h4>–ü—Ä–æ–≥—Ä–µ—Å—Å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö</h4>
                    <div class="operation-status">
                        <div class="operation-step">
                            <span id="background-current-step-text">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</span>
                        </div>
                        <div class="operation-progress-bar">
                            <div id="background-progress-bar-fill" class="operation-progress-fill" style="width: 0%"></div>
                            <div class="operation-progress-text" id="background-overall-progress-text">0%</div>
                        </div>
                        <div class="operation-details">
                            <div class="operation-item">
                                <span class="operation-label">–û–±—Ä–∞–±–æ—Ç–∞–Ω–æ CVE:</span>
                                <span id="background-processed-cves-text">0</span>
                            </div>
                            <div class="operation-item">
                                <span class="operation-label">–í—Å–µ–≥–æ CVE:</span>
                                <span id="background-total-cves-text">0</span>
                            </div>
                            <div class="operation-item">
                                <span class="operation-label">–û–±–Ω–æ–≤–ª–µ–Ω–æ —Ö–æ—Å—Ç–æ–≤:</span>
                                <span id="background-updated-hosts-text">0</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>



        <!-- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ -->
        <div id="settings-page" class="page-content">
            <div class="content-header">
                <h2>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                <p>–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã</p>
            </div>
            
            <div class="settings-container">
                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ -->
                <div class="content-block">
                    <h3><i class="fas fa-tachometer-alt"></i> –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏</h3>
                    <form id="performance-form">
                        <div class="form-group">
                            <label for="vulnanalizer-max-concurrent-requests">–ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î:</label>
                            <input type="number" id="vulnanalizer-max-concurrent-requests" name="max_concurrent_requests" min="1" max="10" value="3" required>
                            <small>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 1-5. –ë–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ = –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –±–æ–ª—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î</small>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-sm">
                                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                            </button>
                        </div>
                    </form>
                </div>

                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Impact -->
                <div class="content-block">
                    <h3>
                        <i class="fas fa-chart-line"></i> –†–∞—Å—á–µ—Ç —Ä–∏—Å–∫–∞ (Impact)
                        <button type="button" class="btn btn-link btn-sm formula-btn" id="show-risk-formula" title="–ü–æ–∫–∞–∑–∞—Ç—å —Ñ–æ—Ä–º—É–ª—É —Ä–∞—Å—á–µ—Ç–∞">
                            <i class="fas fa-square-root-alt"></i>
                        </button>
                    </h3>
                    <form id="impact-form">
                        <div class="form-group">
                            <label for="impact-resource-criticality">–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–∞:</label>
                            <select id="impact-resource-criticality" name="impact_resource_criticality" required>
                                <option value="Critical">Critical (0.33)</option>
                                <option value="High">High (0.25)</option>
                                <option value="Medium">Medium (0.15)</option>
                                <option value="None">None (0.1)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="impact-confidential-data">–ù–∞–ª–∏—á–∏–µ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:</label>
                            <select id="impact-confidential-data" name="impact_confidential_data" required>
                                <option value="–ï—Å—Ç—å">–ï—Å—Ç—å (0.33)</option>
                                <option value="–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç">–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç (0.1)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="impact-internet-access">–î–æ—Å—Ç—É–ø–µ–Ω –∏–∑ —Å–µ—Ç–∏ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç:</label>
                            <select id="impact-internet-access" name="impact_internet_access" required>
                                <option value="–î–æ—Å—Ç—É–ø–µ–Ω">–î–æ—Å—Ç—É–ø–µ–Ω (0.33)</option>
                                <option value="–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω">–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω (0.1)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="risk-threshold">–ü–æ—Ä–æ–≥ —Ä–∏—Å–∫–∞ (–∫—Ä–∞—Å–Ω–∞—è –∑–æ–Ω–∞): <span id="threshold-value">75</span>%</label>
                            <input type="range" id="risk-threshold" name="risk_threshold" min="0" max="100" value="75" class="threshold-slider">
                        </div>
                        <div class="form-group">
                            <label for="max-concurrent-requests">–ú–∞–∫—Å–∏–º—É–º –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î:</label>
                            <input type="number" id="max-concurrent-requests" name="max_concurrent_requests" min="1" max="10" value="3" required>
                            <small>–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è: 1-5. –ë–æ–ª—å—à–µ –∑–∞–ø—Ä–æ—Å–æ–≤ = –±—ã—Å—Ç—Ä–µ–µ, –Ω–æ –±–æ–ª—å—à–µ –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –ë–î</small>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-sm">
                                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å Impact
                            </button>
                        </div>
                    </form>
                </div>

                <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ VM MaxPatrol -->
                <div class="content-block">
                    <h3><i class="fas fa-server"></i> –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å MaxPatrol VM</h3>
                    <form id="vm-settings-form">
                        <div class="form-group">
                            <label for="vm-enabled">–í–∫–ª—é—á–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—é:</label>
                            <select id="vm-enabled" name="vm_enabled" required>
                                <option value="false">–û—Ç–∫–ª—é—á–µ–Ω–æ</option>
                                <option value="true">–í–∫–ª—é—á–µ–Ω–æ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="vm-host">–•–æ—Å—Ç VM:</label>
                            <input type="text" id="vm-host" name="vm_host" placeholder="msk01vm23.corp.local" required>
                            <small>–ê–¥—Ä–µ—Å —Å–µ—Ä–≤–µ—Ä–∞ MaxPatrol VM</small>
                        </div>
                        <div class="form-group">
                            <label for="vm-username">–ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</label>
                            <input type="text" id="vm-username" name="vm_username" placeholder="username" required>
                            <small>–õ–æ–≥–∏–Ω –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ VM API</small>
                        </div>
                        <div class="form-group">
                            <label for="vm-password">–ü–∞—Ä–æ–ª—å:</label>
                            <input type="password" id="vm-password" name="vm_password" placeholder="password" required>
                            <small>–ü–∞—Ä–æ–ª—å –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ VM API</small>
                        </div>
                        <div class="form-group">
                            <label for="vm-client-secret">Client Secret:</label>
                            <input type="password" id="vm-client-secret" name="vm_client_secret" placeholder="client_secret" required>
                            <small>–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è OAuth2 –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏</small>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-sm" id="vm-settings-btn">
                                <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å VM
                            </button>
                            <button type="button" id="vm-test-connection-btn" class="btn btn-info">
                                <i class="fas fa-plug"></i> –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- EPSS -->
                <div class="epss-container content-block">
                    <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã EPSS</h3>
                    <form id="epss-upload-form" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="epss-file">–ó–∞–≥—Ä—É–∑–∏—Ç—å CSV-—Ñ–∞–π–ª:</label>
                            <input type="file" id="epss-file" name="file" accept=".csv" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-sm" id="epss-upload-btn">
                                <i class="fas fa-upload"></i> <span class="btn-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å CSV</span>
                                <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                            </button>
                            <button type="button" id="epss-download-btn" class="btn btn-primary btn-sm">
                                <i class="fas fa-cloud-download-alt"></i> <span class="btn-text">–°–∫–∞—á–∞—Ç—å —Å —Å–∞–π—Ç–∞</span>
                                <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                            </button>
                        </div>
                    </form>
                    <div id="epss-status" style="margin-top:2rem;"></div>
                </div>

                <!-- ExploitDB -->
                <div class="exploitdb-container content-block">
                    <h3>–ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–∑—ã ExploitDB</h3>
                    <form id="exploitdb-upload-form" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="exploitdb-file">–ó–∞–≥—Ä—É–∑–∏—Ç—å CSV-—Ñ–∞–π–ª:</label>
                            <input type="file" id="exploitdb-file" name="file" accept=".csv" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary btn-sm" id="exploitdb-upload-btn">
                                <i class="fas fa-upload"></i> <span class="btn-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å CSV</span>
                                <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                            </button>
                            <button type="button" id="exploitdb-download-btn" class="btn btn-primary btn-sm">
                                <i class="fas fa-cloud-download-alt"></i> <span class="btn-text">–°–∫–∞—á–∞—Ç—å —Å —Å–∞–π—Ç–∞</span>
                                <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                            </button>
                        </div>
                    </form>
                    <div id="exploitdb-status" style="margin-top:2rem;"></div>
                </div>

                <!-- CVE -->
                <div class="cve-container content-block">
                    <h3><i class="fas fa-bug"></i> –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–∑–æ–π CVE</h3>
                    
                    <!-- –í—ã–±–æ—Ä –ª–µ—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ -->
                    <div class="form-group mb-3">
                        <button type="button" class="btn btn-outline-primary btn-sm dropdown-toggle" id="toggle-year-selector">
                            <i class="fas fa-calendar"></i> –í—ã–±—Ä–∞—Ç—å –≥–æ–¥—ã –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏
                            <i class="fas fa-chevron-down ms-1"></i>
                        </button>
                        <div class="year-selector" id="year-selector" style="display: none;">
                            <div class="year-grid" id="year-grid">
                                <!-- –ì–æ–¥—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã —á–µ—Ä–µ–∑ JavaScript -->
                            </div>
                            <div class="year-controls mt-2">
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="select-all-years">
                                    –í—ã–±—Ä–∞—Ç—å –≤—Å–µ
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="select-recent-years">
                                    –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 –ª–µ—Ç
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary" id="clear-years">
                                    –û—á–∏—Å—Ç–∏—Ç—å
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <!-- –ö–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è -->
                    <div class="form-actions">
                        <button id="download-cve-btn" class="btn btn-primary btn-sm">
                            <i class="fas fa-download"></i> –ó–∞–≥—Ä—É–∑–∏—Ç—å CVE
                        </button>
                        <button id="cancel-cve-btn" class="btn btn-danger btn-sm" style="display: none;">
                            <i class="fas fa-stop"></i> –û—Ç–º–µ–Ω–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É
                        </button>
                        <button type="button" id="cve-urls-btn" class="btn btn-info btn-sm">
                            <i class="fas fa-link"></i> –°—Å—ã–ª–∫–∏ –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
                        </button>
                    </div>
                    
                    <!-- –°—Ç–∞—Ç—É—Å –∑–∞–≥—Ä—É–∑–∫–∏ -->
                    <div id="cve-status" class="mt-3"></div>
                    
                    <!-- CVE Status -->
                    <div class="mt-4">
                        <h4><i class="fas fa-info-circle"></i> –°—Ç–∞—Ç—É—Å –±–∞–∑—ã CVE</h4>
                        <div id="cve-count"></div>
                    </div>
                    
                    <!-- –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤ (legacy) -->
                    <div class="mt-4">
                        <h4><i class="fas fa-upload"></i> –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h4>
                        <form id="cve-upload-form" enctype="multipart/form-data">
                            <div class="form-group">
                                <label for="cve-file">–ó–∞–≥—Ä—É–∑–∏—Ç—å JSON-—Ñ–∞–π–ª:</label>
                                <input type="file" id="cve-file" name="file" accept=".json,.gz" required>
                                <small>–ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ —Ñ–æ—Ä–º–∞—Ç—ã: JSON, GZ (–∞—Ä—Ö–∏–≤)</small>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary btn-sm" id="cve-upload-btn">
                                    <i class="fas fa-upload"></i> <span class="btn-text">–ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</span>
                                    <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- –û—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü -->
                <div class="clear-container content-block">
                    <h3>–û—á–∏—Å—Ç–∫–∞ —Ç–∞–±–ª–∏—Ü</h3>
                    <div class="clear-actions">
                        <div class="clear-item">
                            <h4>–•–æ—Å—Ç—ã</h4>
                            <p>–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ —Ö–æ—Å—Ç–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</p>
                            <button type="button" id="clear-hosts-btn" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å —Ö–æ—Å—Ç—ã
                            </button>
                        </div>
                        <div class="clear-item">
                            <h4>EPSS</h4>
                            <p>–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ EPSS –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</p>
                            <button type="button" id="clear-epss-btn" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å EPSS
                            </button>
                        </div>
                        <div class="clear-item">
                            <h4>ExploitDB</h4>
                            <p>–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ ExploitDB –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</p>
                            <button type="button" id="clear-exploitdb-btn" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å ExploitDB
                            </button>
                        </div>
                        <div class="clear-item">
                            <h4>CVE</h4>
                            <p>–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∑–∞–ø–∏—Å–∏ CVE –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö</p>
                            <button type="button" id="clear-cve-btn" class="btn btn-danger btn-sm">
                                <i class="fas fa-trash"></i> –û—á–∏—Å—Ç–∏—Ç—å CVE
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ —Å —Ñ–æ—Ä–º—É–ª–æ–π —Ä–∞—Å—á–µ—Ç–∞ —Ä–∏—Å–∫–∞ -->
<div id="risk-formula-modal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3><i class="fas fa-square-root-alt"></i> –§–æ—Ä–º—É–ª–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ä–∏—Å–∫–∞</h3>
            <button type="button" class="modal-close" id="close-risk-formula">&times;</button>
        </div>
        <div class="modal-body">
            <div class="formula-section">
                <h4>üéØ –û—Å–Ω–æ–≤–Ω–∞—è —Ñ–æ—Ä–º—É–ª–∞</h4>
                <div class="formula-box">
                    <div class="formula-main">
                        <span class="formula-text">Risk = EPSS √ó (CVSS √∑ 10) √ó Impact</span>
                    </div>
                    <div class="formula-note">
                        –ì–¥–µ: <strong>Risk</strong> - –∏—Ç–æ–≥–æ–≤—ã–π —Ä–∏—Å–∫ –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö (0-100%)
                    </div>
                </div>
            </div>

            <div class="formula-section">
                <h4>üìä –†–∞—Å—á–µ—Ç Impact</h4>
                <div class="formula-box">
                    <div class="formula-main">
                        <span class="formula-text">Impact = Resource_Criticality + Confidential_Data + Internet_Access</span>
                    </div>
                </div>
                
                <div class="impact-weights">
                    <div class="weight-group">
                        <h5>‚öñÔ∏è –ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–∞:</h5>
                        <ul>
                            <li><strong>Critical:</strong> 0.33</li>
                            <li><strong>High:</strong> 0.25</li>
                            <li><strong>Medium:</strong> 0.15</li>
                            <li><strong>None:</strong> 0.1</li>
                        </ul>
                    </div>
                    
                    <div class="weight-group">
                        <h5>üîí –ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</h5>
                        <ul>
                            <li><strong>–ï—Å—Ç—å:</strong> 0.33</li>
                            <li><strong>–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç:</strong> 0.1</li>
                        </ul>
                    </div>
                    
                    <div class="weight-group">
                        <h5>üåê –î–æ—Å—Ç—É–ø –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞:</h5>
                        <ul>
                            <li><strong>–î–æ—Å—Ç—É–ø–µ–Ω:</strong> 0.33</li>
                            <li><strong>–ù–µ–¥–æ—Å—Ç—É–ø–µ–Ω:</strong> 0.1</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="formula-section">
                <h4>üìà –ü—Ä–∏–º–µ—Ä —Ä–∞—Å—á–µ—Ç–∞</h4>
                <div class="example-box">
                    <div class="example-data">
                        <p><strong>–ò—Å—Ö–æ–¥–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:</strong></p>
                        <ul>
                            <li>EPSS = 0.5 (50% –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏)</li>
                            <li>CVSS = 8.0 (–≤—ã—Å–æ–∫–∞—è –∫—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å)</li>
                            <li>–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å —Ä–µ—Å—É—Ä—Å–∞ = Critical (0.33)</li>
                            <li>–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ = –ï—Å—Ç—å (0.33)</li>
                            <li>–î–æ—Å—Ç—É–ø –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞ = –î–æ—Å—Ç—É–ø–µ–Ω (0.33)</li>
                        </ul>
                    </div>
                    
                    <div class="example-calculation">
                        <p><strong>–†–∞—Å—á–µ—Ç:</strong></p>
                        <div class="calculation-steps">
                            <div class="step">1. Impact = 0.33 + 0.33 + 0.33 = <strong>0.99</strong></div>
                            <div class="step">2. Risk = 0.5 √ó (8.0 √∑ 10) √ó 0.99 = <strong>0.396</strong></div>
                            <div class="step">3. Risk Score = min(1, 0.396) √ó 100 = <strong>39.6%</strong></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="formula-section">
                <h4>üéöÔ∏è –®–∫–∞–ª–∞ —Ä–∏—Å–∫–∞</h4>
                <div class="risk-scale">
                    <div class="risk-level low">
                        <span class="level-name">–ù–∏–∑–∫–∏–π —Ä–∏—Å–∫</span>
                        <span class="level-range">0-20%</span>
                    </div>
                    <div class="risk-level medium">
                        <span class="level-name">–°—Ä–µ–¥–Ω–∏–π —Ä–∏—Å–∫</span>
                        <span class="level-range">20-40%</span>
                    </div>
                    <div class="risk-level high">
                        <span class="level-name">–í—ã—Å–æ–∫–∏–π —Ä–∏—Å–∫</span>
                        <span class="level-range">40-70%</span>
                    </div>
                    <div class="risk-level critical">
                        <span class="level-name">–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–π —Ä–∏—Å–∫</span>
                        <span class="level-range">70-100%</span>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è -->
<div id="notifications" class="notifications"></div>

<!-- –°–∫—Ä–∏–ø—Ç—ã -->
    <script src="/vulnanalizer/static/js/modules/notifications.js?v=2.1"></script>
<script src="/vulnanalizer/static/js/modules/api.js?v=2.4"></script>
<script src="/vulnanalizer/static/js/modules/auth.js?v=2.0"></script>
    <script src="/vulnanalizer/static/js/modules/hosts.js?v=3.2"></script>
<script src="/vulnanalizer/static/js/modules/epss.js?v=2.0"></script>
<script src="/vulnanalizer/static/js/modules/exploitdb.js?v=2.0"></script>
<script src="/vulnanalizer/static/js/modules/cve.js?v=2.0"></script>
<script src="/vulnanalizer/static/js/modules/cve-manager.js?v=1.0"></script>
    <script src="/vulnanalizer/static/js/modules/settings.js?v=2.1"></script>
<script src="/vulnanalizer/static/js/modules/vm.js?v=2.0"></script>
<script src="/vulnanalizer/static/js/modules/navigation.js?v=2.0"></script>
<script src="/vulnanalizer/static/js/modules/utils.js?v=2.0"></script>
    <script src="/vulnanalizer/static/js/app.js?v=5.5"></script>


{% endblock %}
