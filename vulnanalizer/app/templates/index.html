<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VulnAnalizer - Анализ уязвимостей</title>
    <link rel="icon" type="image/svg+xml" href="/vulnanalizer/static/favicon.svg">
    <link rel="stylesheet" href="/static/css/style.css?v=1.1">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body class="light-theme">
    <!-- Верхняя панель переключения сервисов -->
    <div class="top-bar">
        <div class="service-switcher">
            <a href="/vulnanalizer/" class="service-link active" id="vulnanalizer-link">
                <i class="fas fa-shield-alt"></i>
                <span>VulnAnalizer</span>
            </a>
            <a href="/loganalizer/" class="service-link" id="loganalizer-link">
                <i class="fas fa-file-alt"></i>
                <span>LogAnalizer</span>
            </a>
        </div>
        <div class="top-bar-right">
            <div class="settings-menu">
                <button id="settings-toggle" class="settings-btn">
                    <i class="fas fa-cog"></i>
                </button>
                <div id="settings-dropdown" class="settings-dropdown">
                    <a href="#" id="users-link">
                        <i class="fas fa-users"></i>
                        <span>Пользователи</span>
                    </a>
                </div>
            </div>
            <div class="user-menu">
                <button id="user-toggle" class="user-btn">
                    <i class="fas fa-user"></i>
                </button>
                <div id="user-dropdown" class="user-dropdown">
                    <div class="user-info">
                        <i class="fas fa-user-circle"></i>
                        <span id="user-name">Пользователь</span>
                    </div>
                    <a href="#" id="theme-link">
                        <i class="fas fa-sun"></i>
                        <span id="theme-text">Светлая</span>
                    </a>
                    <a href="#" id="logout-link">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Выйти</span>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- Боковое меню -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-shield-alt"></i> VulnAnalizer</h2>
            </div>
            
            <nav class="sidebar-nav">
                <ul>
                    <li>
                        <a href="#" class="nav-link active" data-page="analysis">
                            <i class="fas fa-search"></i>
                            <span>Поиск</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-link" data-page="hosts">
                            <i class="fas fa-upload"></i>
                            <span>Импорт</span>
                        </a>
                    </li>
                    <li>
                        <a href="#" class="nav-link" data-page="settings">
                            <i class="fas fa-cog"></i>
                            <span>Настройки</span>
                        </a>
                    </li>

                </ul>
            </nav>
        </aside>

        <!-- Основной контент -->
        <main class="main-content">
            <header class="content-header">
                <h1 id="page-title">Поиск</h1>
            </header>

            <!-- Страница анализа -->
            <div id="analysis-page" class="page-content active">
                <div class="analysis-container">
                    <div class="hosts-search-form">
                        <h3>Поиск</h3>
                        <form id="hosts-search-form">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="hostname-search">Имя хоста:</label>
                                    <input type="text" id="hostname-search" name="hostname" placeholder="server.example.com">
                                </div>
                                <div class="form-group">
                                    <label for="ip-search">IP адрес:</label>
                                    <input type="text" id="ip-search" name="ip_address" placeholder="192.168.1.1">
                                </div>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="cve-host-search">CVE:</label>
                                    <input type="text" id="cve-host-search" name="cve" placeholder="CVE-2021-44228">
                                </div>
                                <div class="form-group">
                                    <label for="criticality-search">Критичность:</label>
                                    <select id="criticality-search" name="criticality">
                                        <option value="">Все</option>
                                        <option value="Critical">Critical</option>
                                        <option value="High">High</option>
                                        <option value="Medium">Medium</option>
                                        <option value="Low">Low</option>
                                    </select>
                                </div>
                            </div>
                            <div class="form-group">
                                <input type="checkbox" id="exploits-only" name="exploits_only" style="width: auto; height: auto; margin: 0; padding: 0;">
                                <label for="exploits-only" style="display: inline; margin-left: 4px;">Только с эксплойтами</label>
                            </div>
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-search"></i> Поиск
                                </button>
                                <button type="button" id="clear-hosts-results" class="btn btn-secondary">
                                    <i class="fas fa-times"></i> Очистить
                                </button>
                                <button type="button" id="export-hosts" class="btn btn-success">
                                    <i class="fas fa-file-excel"></i> Экспорт в Excel
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
                
                <!-- Отдельный контейнер для результатов поиска -->
                <div class="hosts-search-results-container">
                    <div id="hosts-search-results" class="hosts-results">
                        <!-- Результаты поиска хостов будут загружены динамически -->
                    </div>
                </div>
            </div>

            <!-- Страница настроек -->
            <div id="settings-page" class="page-content">
                <div class="settings-container">
                    <h3>Настройки подключения к базе данных</h3>
                    <form id="settings-form">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="db-host">Хост базы данных:</label>
                                <input type="text" id="db-host" name="database_host" required>
                            </div>
                            <div class="form-group">
                                <label for="db-port">Порт:</label>
                                <input type="text" id="db-port" name="database_port" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="db-name">Имя базы данных:</label>
                                <input type="text" id="db-name" name="database_name" required>
                            </div>
                            <div class="form-group">
                                <label for="db-user">Пользователь:</label>
                                <input type="text" id="db-user" name="database_user" required>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="db-password">Пароль:</label>
                            <input type="password" id="db-password" name="database_password" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Сохранить настройки
                            </button>
                            <button type="button" id="test-connection" class="btn btn-primary">
                                <i class="fas fa-plug"></i> Проверить подключение
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Настройки Impact -->
                <div class="impact-container">
                    <h3>Настройки расчета риска (Impact)</h3>
                    <form id="impact-form">
                        <div class="form-group">
                            <label for="impact-resource-criticality">Критичность ресурса:</label>
                            <select id="impact-resource-criticality" name="impact_resource_criticality" required>
                                <option value="Critical">Critical (0.33)</option>
                                <option value="High">High (0.25)</option>
                                <option value="Medium">Medium (0.15)</option>
                                <option value="None">None (0.1)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="impact-confidential-data">Наличие конфиденциальных данных:</label>
                            <select id="impact-confidential-data" name="impact_confidential_data" required>
                                <option value="Есть">Есть (0.33)</option>
                                <option value="Отсутствуют">Отсутствуют (0.1)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="impact-internet-access">Доступен из сети интернет:</label>
                            <select id="impact-internet-access" name="impact_internet_access" required>
                                <option value="Доступен">Доступен (0.33)</option>
                                <option value="Недоступен">Недоступен (0.1)</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="risk-threshold">Порог риска (красная зона): <span id="threshold-value">75</span>%</label>
                            <input type="range" id="risk-threshold" name="risk_threshold" min="0" max="100" value="75" class="threshold-slider">
                            <div class="threshold-labels">
                                <span>0%</span>
                                <span>100%</span>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="max-concurrent-requests">Максимум одновременных запросов к БД:</label>
                            <input type="number" id="max-concurrent-requests" name="max_concurrent_requests" min="1" max="10" value="3" required>
                            <small>Рекомендуется: 1-5. Больше запросов = быстрее, но больше нагрузка на БД</small>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Сохранить настройки Impact
                            </button>
                        </div>
                    </form>
                </div>
                
                <!-- Отдельный блок EPSS -->
                <div class="epss-container">
                    <h3>Загрузка базы EPSS</h3>
                    <form id="epss-upload-form" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="epss-file">Загрузить CSV-файл:</label>
                            <input type="file" id="epss-file" name="file" accept=".csv" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="epss-upload-btn">
                                <i class="fas fa-upload"></i> <span class="btn-text">Загрузить CSV</span>
                                <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                            </button>
                            <button type="button" id="epss-download-btn" class="btn btn-primary">
                                <i class="fas fa-cloud-download-alt"></i> <span class="btn-text">Скачать с сайта</span>
                                <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                            </button>
                        </div>
                    </form>
                    <div id="epss-status" style="margin-top:2rem;"></div>
                </div>
                
                <!-- Отдельный блок Exploit DB -->
                <div class="exploitdb-container">
                    <h3>Загрузка базы Exploit DB</h3>
                    <form id="exploitdb-upload-form" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="exploitdb-file">Загрузить CSV-файл:</label>
                            <input type="file" id="exploitdb-file" name="file" accept=".csv" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="exploitdb-upload-btn">
                                <i class="fas fa-upload"></i> <span class="btn-text">Загрузить CSV</span>
                                <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                            </button>
                            <button type="button" id="exploitdb-download-btn" class="btn btn-primary">
                                <i class="fas fa-cloud-download-alt"></i> <span class="btn-text">Скачать с сайта</span>
                                <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                            </button>
                        </div>
                    </form>
                    <div id="exploitdb-status" style="margin-top:2rem;"></div>
                </div>
                
                <!-- Секция очистки таблиц -->
                <div class="clear-container">
                    <h3>Очистка таблиц</h3>
                    <div class="clear-actions">
                        <div class="clear-item">
                            <h4>Хосты</h4>
                            <p>Удалить все записи хостов из базы данных</p>
                            <button type="button" id="clear-hosts-btn" class="btn btn-danger">
                                <i class="fas fa-trash"></i> Очистить хосты
                            </button>
                        </div>
                        <div class="clear-item">
                            <h4>EPSS</h4>
                            <p>Удалить все записи EPSS из базы данных</p>
                            <button type="button" id="clear-epss-btn" class="btn btn-danger">
                                <i class="fas fa-trash"></i> Очистить EPSS
                            </button>
                        </div>
                        <div class="clear-item">
                            <h4>ExploitDB</h4>
                            <p>Удалить все записи ExploitDB из базы данных</p>
                            <button type="button" id="clear-exploitdb-btn" class="btn btn-danger">
                                <i class="fas fa-trash"></i> Очистить ExploitDB
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Страница хостов -->
            <div id="hosts-page" class="page-content">
                <div class="hosts-container">
                    <h3>Импорт хостов из MP VM</h3>
                    <form id="hosts-upload-form" enctype="multipart/form-data">
                        <div class="form-group">
                            <label for="hosts-file">Загрузить CSV-файл:</label>
                            <input type="file" id="hosts-file" name="file" accept=".csv" required>
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" id="hosts-upload-btn">
                                <i class="fas fa-upload"></i> <span class="btn-text">Загрузить CSV</span>
                                <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                            </button>
                            <button type="button" id="update-hosts-data-btn" class="btn btn-warning">
                                <i class="fas fa-sync-alt"></i> <span class="btn-text">Обновить данные EPSS/Эксплойтов</span>
                                <i class="fas fa-spinner fa-spin" style="display:none;"></i>
                            </button>
                        </div>
                    </form>
                    <div id="hosts-status" style="margin-top:2rem;"></div>
                </div>
            </div>


        </main>
    </div>

    <!-- Уведомления -->
    <div id="notifications" class="notifications"></div>

    <script src="/vulnanalizer/static/js/app.js?v=2.1"></script>
</body>
</html> 