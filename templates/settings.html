{% extends "base.html" %}

{% block title %}Настройки системы - STools{% endblock %}

{% block extra_css %}
{% endblock %}

<!-- Используем обработчики из base.html -->

{% block content %}
<main class="main-content">
    <div class="page-container">
        <div class="content-header">
            <h1><i class="fas fa-cogs"></i> Настройки системы</h1>
            <p>Общие настройки для всех сервисов STools</p>
        </div>

        <!-- Подключение к базе данных -->
        <div class="collapsible-block">
            <div class="collapsible-header" data-target="database-settings">
                <h3><i class="fas fa-database"></i> Подключение к базе данных</h3>
                <div class="collapsible-arrow">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
            <div class="collapsible-content" id="database-settings">
                <form id="database-settings-form">
                <div class="form-row">
                    <div class="form-group">
                        <label for="db-host">Хост базы данных:</label>
                        <input type="text" id="db-host" name="database_host" required>
                    </div>
                    <div class="form-group">
                        <label for="db-port">Порт:</label>
                        <input type="text" id="db-port" name="database_port" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="db-name">Имя базы данных:</label>
                        <input type="text" id="db-name" name="database_name" required>
                    </div>
                    <div class="form-group">
                        <label for="db-user">Пользователь:</label>
                        <input type="text" id="db-user" name="database_user" required>
                    </div>
                </div>
                <div class="form-group">
                    <label for="db-password">Пароль:</label>
                    <input type="password" id="db-password" name="database_password" required>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary btn-sm">
                        <i class="fas fa-save"></i> Сохранить настройки БД
                    </button>
                    <button type="button" id="test-connection" class="btn btn-info btn-sm">
                        <i class="fas fa-plug"></i> Проверить подключение
                    </button>
                </div>
            </form>
            </div>
        </div>

        <!-- Общие настройки -->
        <div class="collapsible-block">
            <div class="collapsible-header" data-target="general-settings">
                <h3><i class="fas fa-sliders-h"></i> Общие настройки</h3>
                <div class="collapsible-arrow">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
            <div class="collapsible-content" id="general-settings">
                <form id="general-settings-form">
                <div class="form-group">
                    <label for="system-name">Название системы:</label>
                    <input type="text" id="system-name" name="system_name" value="STools" required>
                </div>
                <div class="form-group">
                    <label for="session-timeout">Таймаут сессии (минуты):</label>
                    <input type="number" id="session-timeout" name="session_timeout" min="5" max="1440" value="60" required>
                    <small>От 5 минут до 24 часов</small>
                </div>
                <div class="form-group">
                    <label for="max-file-size">Максимальный размер файла (MB):</label>
                    <input type="number" id="max-file-size" name="max_file_size" min="1" max="1024" value="100" required>
                    <small>Максимальный размер загружаемых файлов</small>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary btn-sm">
                        <i class="fas fa-save"></i> Сохранить общие настройки
                    </button>
                </div>
            </form>
            </div>
        </div>

        <!-- Настройки безопасности -->
        <div class="collapsible-block">
            <div class="collapsible-header" data-target="security-settings">
                <h3><i class="fas fa-shield-alt"></i> Настройки безопасности</h3>
                <div class="collapsible-arrow">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
            <div class="collapsible-content" id="security-settings">
                <form id="security-settings-form">
                <div class="form-group">
                    <label for="password-min-length">Минимальная длина пароля:</label>
                    <input type="number" id="password-min-length" name="password_min_length" min="6" max="50" value="8" required>
                </div>
                <div class="form-group">
                    <label for="failed-login-attempts">Максимум неудачных попыток входа:</label>
                    <input type="number" id="failed-login-attempts" name="failed_login_attempts" min="3" max="10" value="5" required>
                </div>
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="require-password-change" name="require_password_change">
                    <label for="require-password-change">Требовать смену пароля при первом входе</label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary btn-sm">
                        <i class="fas fa-save"></i> Сохранить настройки безопасности
                    </button>
                </div>
            </form>
            </div>
        </div>

        <!-- Управление логами -->
        <div class="collapsible-block">
            <div class="collapsible-header" data-target="logs-management">
                <h3><i class="fas fa-file-alt"></i> Управление логами</h3>
                <div class="collapsible-arrow">
                    <i class="fas fa-chevron-down"></i>
                </div>
            </div>
            <div class="collapsible-content" id="logs-management">
                <!-- Статистика логов -->
                <div class="logs-stats-section">
                    <h4><i class="fas fa-chart-bar"></i> Статистика логов</h4>
                    <div class="logs-stats" id="logs-stats">
                        <div class="loading">Загрузка статистики...</div>
                    </div>
                </div>

                <!-- Список файлов логов -->
                <div class="logs-files-section">
                    <h4><i class="fas fa-list"></i> Файлы логов</h4>
                    <div class="logs-files-controls">
                        <div class="form-group">
                            <label for="logs-task-type-filter">Фильтр по типу задачи:</label>
                            <select id="logs-task-type-filter">
                                <option value="">Все типы</option>
                                <option value="vm_import">VM Импорт</option>
                                <option value="hosts_update">Обновление хостов</option>
                                <option value="backup_create">Создание бэкапа</option>
                                <option value="epss_download">Загрузка EPSS</option>
                            </select>
                        </div>
                        <div class="form-actions">
                            <button type="button" class="btn btn-secondary btn-sm" id="refresh-logs-btn">
                                <i class="fas fa-sync-alt"></i> Обновить
                            </button>
                            <button type="button" class="btn btn-danger btn-sm" id="cleanup-logs-btn">
                                <i class="fas fa-trash"></i> Очистить старые
                            </button>
                        </div>
                    </div>
                    <div class="logs-files-list" id="logs-files-list">
                        <div class="loading">Загрузка файлов логов...</div>
                    </div>
                </div>
            </div>
        </div>
</main>

<!-- Уведомления -->
<div id="notifications" class="notifications"></div>

<!-- Скрипты -->
        <script src="/static/js/settings.js?v=1.1"></script>
        <script src="/static/js/modules/logs-manager.js?v=1.4"></script>
{% endblock %}
