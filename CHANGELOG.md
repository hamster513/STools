# Changelog - VulnAnalizer

## [2.0.0] - 2025-07-31

### Добавлено
- **Расширенная таблица хостов** с новыми полями:
  - `epss_score` - EPSS score (вероятность эксплуатации)
  - `epss_percentile` - EPSS percentile (процентиль)
  - `risk_score` - Рассчитанный риск в процентах
  - `risk_raw` - Сырое значение риска
  - `impact_score` - Impact score для расчета риска
  - `exploits_count` - Количество эксплойтов
  - `verified_exploits_count` - Количество верифицированных эксплойтов
  - `has_exploits` - Флаг наличия эксплойтов
  - `last_exploit_date` - Дата последнего эксплойта
  - `epss_updated_at` - Время обновления EPSS данных
  - `exploits_updated_at` - Время обновления данных эксплойтов
  - `risk_updated_at` - Время обновления расчета риска

### Изменено
- **Логика импорта хостов**: теперь при импорте автоматически рассчитываются EPSS, эксплойты и риск
- **Функция расчета риска**: перенесена в класс Database для использования при импорте
- **Отображение хостов**: добавлены новые поля в интерфейс с цветовой индикацией риска
- **Экспорт в Excel**: расширен для включения всех новых полей

### Добавлено в API
- `POST /api/hosts/update-data` - Обновление данных EPSS и эксплойтов для всех хостов
- Обновлены существующие endpoints для работы с новыми полями

### Добавлено в интерфейс
- Кнопка "Обновить данные EPSS/Эксплойтов" для ручного обновления
- Отображение EPSS score и percentile
- Отображение рассчитанного риска с цветовой индикацией
- Отображение информации об эксплойтах
- Отображение времени последнего обновления данных

### Улучшения производительности
- Добавлены индексы для полей `cve`, `risk_score`, `has_exploits`
- Оптимизированы запросы к базе данных

### Технические изменения
- Обновлена схема базы данных (`init-db/init.sql`)
- Добавлены новые модели данных (`app/models.py`)
- Расширен класс Database (`app/database.py`)
- Обновлен API (`app/main.py`)
- Добавлены новые стили CSS (`app/static/css/style.css`)
- Обновлен JavaScript (`app/static/js/app.js`)

### Формула расчета риска
```
raw_risk = EPSS * (CVSS / 10) * Impact
risk_score = min(1, raw_risk) * 100
```

где Impact рассчитывается на основе:
- Критичности ресурса (Critical: 0.33, High: 0.25, Medium: 0.15, None: 0.1)
- Наличия конфиденциальных данных (Есть: 0.33, Отсутствуют: 0.1)
- Доступа к интернету (Доступен: 0.33, Недоступен: 0.1) 