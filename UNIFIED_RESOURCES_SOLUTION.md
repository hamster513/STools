# üéØ –ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –µ–¥–∏–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

## ‚úÖ –ü—Ä–∏–Ω—Ü–∏–ø: –ï–¥–∏–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã, –∞ –Ω–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

### üö´ –ß—Ç–æ –ù–ï –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å:
```sql
-- –ù–ï —Å–æ–∑–¥–∞–≤–∞—Ç—å –¥—É–±–ª–∏—Ä—É—é—â–∏–µ —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE vulnanalizer.users (...);  -- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
CREATE TABLE loganalizer.users (...);   -- ‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
```

### ‚úÖ –ß—Ç–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å:
```sql
-- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–¥–∏–Ω—É—é —Ç–∞–±–ª–∏—Ü—É –≤ —Å—Ö–µ–º–µ auth
SELECT * FROM auth.users;  -- ‚úÖ –ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã
```

## üîß –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ

### 1. –ï–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ:** `auth.users`
- **–î–æ—Å—Ç—É–ø:** –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –æ–¥–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ
- **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:** –ù–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è, –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### 2. –ò–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–¥–∞ vulnanalizer
```python
# –í –º–µ—Ç–æ–¥–∞—Ö —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –¥–æ–±–∞–≤–ª–µ–Ω:
await conn.execute('SET search_path TO auth')
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –º–µ—Ç–æ–¥—ã –≤ vulnanalizer/app/database.py:
- ‚úÖ `create_user()` - —Å–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ auth.users
- ‚úÖ `get_user_by_username()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ auth.users
- ‚úÖ `get_user_by_id()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –∏–∑ auth.users
- ‚úÖ `get_all_users()` - –ø–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –∏–∑ auth.users
- ‚úÖ `update_user()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ auth.users
- ‚úÖ `update_user_password()` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –≤ auth.users
- ‚úÖ `delete_user()` - —É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ auth.users
- ‚úÖ `initialize_admin_user()` - –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤ auth.users

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –µ–¥–∏–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

### –°—Ö–µ–º–∞ auth (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è):
```
auth.users          - –ï–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
auth.sessions       - –ï–¥–∏–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ —Å–µ—Å—Å–∏–π
```

### –°—Ö–µ–º–∞ vulnanalizer (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è):
```
vulnanalizer.hosts              - –•–æ—Å—Ç—ã
vulnanalizer.cve_data           - –î–∞–Ω–Ω—ã–µ CVE
vulnanalizer.epss_data          - –î–∞–Ω–Ω—ã–µ EPSS
vulnanalizer.exploitdb_data     - –î–∞–Ω–Ω—ã–µ ExploitDB
vulnanalizer.background_tasks   - –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
vulnanalizer.system_settings    - –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–∏—Å—Ç–µ–º—ã
```

### –°—Ö–µ–º–∞ loganalizer (—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–∞—è):
```
loganalizer.log_files           - –§–∞–π–ª—ã –ª–æ–≥–æ–≤
loganalizer.log_entries         - –ó–∞–ø–∏—Å–∏ –ª–æ–≥–æ–≤
loganalizer.settings            - –ù–∞—Å—Ç—Ä–æ–π–∫–∏
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –µ–¥–∏–Ω—ã—Ö —Ä–µ—Å—É—Ä—Å–æ–≤

### 1. **–ö–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö**
- –û–¥–∏–Ω –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- –ù–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏–π –º–µ–∂–¥—É —Å–µ—Ä–≤–∏—Å–∞–º–∏
- –ê—Ç–æ–º–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

### 2. **–£–ø—Ä–æ—â–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**
- –û–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ä–µ–∑–µ—Ä–≤–Ω–æ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- –û–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
- –û–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è –∞—É–¥–∏—Ç–∞

### 3. **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–∞–≤–∞–º–∏
- –ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ò–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ —Å—Ö–µ–º—ã

### 4. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
- –ú–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –î–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
GET /vulnanalizer/api/users/all
500 Internal Server Error
relation "users" does not exist
```

### ‚úÖ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:
```
GET /vulnanalizer/api/users/all
{"detail":"Not authenticated"}
```

### ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
```sql
SELECT * FROM auth.users;
-- id | username | email | is_admin | is_active
--  1 | admin    | admin@stools.local | t | t
```

## üîç –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ö–µ–º –≤ PostgreSQL:
```python
# –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
await conn.execute('SET search_path TO auth')

# –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ vulnanalizer
await conn.execute('SET search_path TO vulnanalizer')

# –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ loganalizer  
await conn.execute('SET search_path TO loganalizer')
```

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞:
```sql
-- vulnanalizer_user –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø –∫ —Å—Ö–µ–º–µ auth –¥–ª—è —á—Ç–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
GRANT USAGE ON SCHEMA auth TO vulnanalizer_user;
GRANT SELECT, INSERT, UPDATE, DELETE ON auth.users TO vulnanalizer_user;
```

## üéâ –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

### ‚úÖ –ü—Ä–∏–Ω—Ü–∏–ø—ã —Å–æ–±–ª—é–¥–µ–Ω—ã:
- **–ï–¥–∏–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã** - –æ–¥–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- **–ò–∑–æ–ª—è—Ü–∏—è** - —á–µ—Ä–µ–∑ —Å—Ö–µ–º—ã PostgreSQL
- **–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å** - –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –Ω–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è

### ‚úÖ –†–µ–∑—É–ª—å—Ç–∞—Ç:
- API —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –î–∞–Ω–Ω—ã–µ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–∞
- –°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É

**–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ: –∏—Å–ø–æ–ª—å–∑—É–µ–º –µ–¥–∏–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã!** üéØ

