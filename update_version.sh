#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤–µ—Ä—Å–∏–∏ –ø—Ä–æ–µ–∫—Ç–∞
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./update_version.sh <–Ω–æ–≤–∞—è_–≤–µ—Ä—Å–∏—è>
# –ü—Ä–∏–º–µ—Ä: ./update_version.sh 0.1.0002

set -e

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–µ—Ä–µ–¥–∞–Ω–∞ –≤–µ—Ä—Å–∏—è
if [ $# -eq 0 ]; then
    echo "‚ùå –û—à–∏–±–∫–∞: –ù–µ —É–∫–∞–∑–∞–Ω–∞ –Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è"
    echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 <–Ω–æ–≤–∞—è_–≤–µ—Ä—Å–∏—è>"
    echo "–ü—Ä–∏–º–µ—Ä: $0 0.1.0002"
    exit 1
fi

NEW_VERSION=$1

echo "üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏–∏ –¥–æ $NEW_VERSION..."

# –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é –≤–µ—Ä—Å–∏—é –ø—Ä–æ–µ–∫—Ç–∞
echo "$NEW_VERSION" > VERSION
echo "‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –ø—Ä–æ–µ–∫—Ç–∞: $NEW_VERSION"

# –ö–æ–ø–∏—Ä—É–µ–º –≤–µ—Ä—Å–∏—é –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
cp VERSION auth/VERSION
cp VERSION loganalizer/app/VERSION
cp VERSION vulnanalizer/app/VERSION
echo "‚úÖ –°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∞ –≤–µ—Ä—Å–∏—è –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π"

echo ""
echo "üéâ –í–µ—Ä—Å–∏—è —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ $NEW_VERSION"
echo "üìù –§–∞–π–ª VERSION –æ–±–Ω–æ–≤–ª–µ–Ω –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è"
